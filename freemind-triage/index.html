<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>FREEMIND — Collaboration Triage</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f9fafb;
      color: #111827;
      min-height: 100vh;
    }

    .app { max-width: 480px; margin: 0 auto; background: #fff; min-height: 100vh; }

    /* HEADER */
    .header { padding: 24px 20px 0; border-bottom: 1px solid #f3f4f6; background: #fff; position: sticky; top: 0; z-index: 10; }
    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .header-title { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; }
    .header-sub { font-size: 11px; color: #9ca3af; margin-top: 2px; }
    .status-badge { display: flex; align-items: center; gap: 6px; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 20px; padding: 4px 10px; }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: #16a34a; }
    .status-text { font-size: 11px; color: #15803d; font-weight: 500; }

    /* CATEGORY SUMMARY */
    .cat-summary { display: flex; gap: 8px; margin-bottom: 20px; }
    .cat-card { flex: 1; border-radius: 10px; padding: 12px 8px; text-align: center; border: 1px solid; }
    .cat-count { font-size: 24px; font-weight: 700; }
    .cat-label { font-size: 10px; font-weight: 600; margin-top: 2px; }

    .cat1-active { background: #fef2f2; border-color: #fecaca; }
    .cat1-active .cat-count, .cat1-active .cat-label { color: #dc2626; }
    .cat2-active { background: #eff6ff; border-color: #bfdbfe; }
    .cat2-active .cat-count, .cat2-active .cat-label { color: #2563eb; }
    .cat3-active { background: #f5f3ff; border-color: #ddd6fe; }
    .cat3-active .cat-count, .cat3-active .cat-label { color: #7c3aed; }
    .cat-inactive { background: #fafafa; border-color: #e5e7eb; }
    .cat-inactive .cat-count, .cat-inactive .cat-label { color: #d1d5db; }

    /* TABS */
    .tabs { display: flex; }
    .tab { flex: 1; padding: 10px 0; background: none; border: none; border-bottom: 2px solid transparent; font-size: 13px; cursor: pointer; color: #9ca3af; }
    .tab.active { border-bottom-color: #111827; color: #111827; font-weight: 600; }

    /* SIGNAL LIST */
    .list { padding: 16px; }
    .empty { text-align: center; color: #9ca3af; padding: 48px 20px; font-size: 13px; }

    .signal-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 14px; margin-bottom: 10px; cursor: pointer; transition: box-shadow 0.15s, border-color 0.15s; border-left-width: 3px; }
    .signal-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .signal-card.resolved { cursor: default; }

    .signal-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .signal-badge { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: 4px; }
    .signal-time { font-size: 10px; color: #9ca3af; }
    .signal-title { font-size: 13px; font-weight: 600; color: #111827; margin-bottom: 4px; }
    .signal-detail { font-size: 12px; color: #6b7280; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .signal-decision { margin-top: 10px; padding-top: 10px; border-top: 1px solid #f3f4f6; font-size: 11px; font-weight: 500; }

    /* Category colour helpers */
    .c1 { border-left-color: #dc2626; }
    .c1 .signal-badge { color: #dc2626; background: #fef2f2; }
    .c2 { border-left-color: #2563eb; }
    .c2 .signal-badge { color: #2563eb; background: #eff6ff; }
    .c3 { border-left-color: #7c3aed; }
    .c3 .signal-badge { color: #7c3aed; background: #f5f3ff; }

    /* DETAIL VIEW */
    .detail { padding: 16px; }
    .back-btn { background: none; border: none; color: #6b7280; font-size: 12px; cursor: pointer; margin-bottom: 16px; display: flex; align-items: center; gap: 4px; }
    .detail-card { border-radius: 10px; padding: 16px; margin-bottom: 20px; border: 1px solid; border-left-width: 3px; }
    .detail-card.c1 { background: #fef2f2; border-color: #fecaca; border-left-color: #dc2626; }
    .detail-card.c2 { background: #eff6ff; border-color: #bfdbfe; border-left-color: #2563eb; }
    .detail-card.c3 { background: #f5f3ff; border-color: #ddd6fe; border-left-color: #7c3aed; }
    .detail-badge { font-size: 10px; font-weight: 600; background: #fff; padding: 2px 8px; border-radius: 4px; border: 1px solid; }
    .c1 .detail-badge { color: #dc2626; border-color: #fecaca; }
    .c2 .detail-badge { color: #2563eb; border-color: #bfdbfe; }
    .c3 .detail-badge { color: #7c3aed; border-color: #ddd6fe; }
    .detail-title { font-size: 15px; font-weight: 700; color: #111827; margin: 10px 0; }
    .detail-body { font-size: 12px; color: #4b5563; line-height: 1.7; }

    .triage-label { font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-bottom: 12px; }
    .triage-btn { width: 100%; background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 14px 16px; margin-bottom: 8px; cursor: pointer; text-align: left; transition: all 0.15s; }
    .triage-btn:hover { box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
    .triage-btn-title { font-size: 13px; font-weight: 600; margin-bottom: 3px; }
    .triage-btn-sub { font-size: 11px; color: #9ca3af; }

    /* LOADING */
    .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; gap: 16px; }
    .loading-spinner { width: 32px; height: 32px; border: 2px solid #e5e7eb; border-top-color: #111827; border-radius: 50%; animation: spin 0.8s linear infinite; }
    .loading-text { font-size: 13px; color: #6b7280; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ERROR */
    .error-state { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; gap: 12px; padding: 32px; text-align: center; }
    .error-title { font-size: 14px; font-weight: 600; color: #dc2626; }
    .error-body { font-size: 12px; color: #6b7280; line-height: 1.6; }
  </style>
</head>
<body>
<div class="app">

  <div class="header">
    <div class="header-top">
      <div>
        <div class="header-title">FREEMIND</div>
        <div class="header-sub">Collaboration Triage</div>
      </div>
      <div class="status-badge">
        <div class="status-dot"></div>
        <span class="status-text">Active</span>
      </div>
    </div>
    <div class="cat-summary" id="catSummary"></div>
    <div class="tabs">
      <button class="tab active" id="tabQueue" onclick="switchTab('queue')">Queue</button>
      <button class="tab" id="tabResolved" onclick="switchTab('resolved')">Resolved</button>
    </div>
  </div>

  <div id="mainContent"></div>

</div>

<script>
  // ── State ──────────────────────────────────────────────────────
  let signals = [];
  let triaged = {};  // id -> decision key
  let currentView = 'queue';
  let selectedId = null;

  const CAT_META = {
    1: { label: 'Operational',   color: '#dc2626' },
    2: { label: 'Developmental', color: '#2563eb' },
    3: { label: 'Wellbeing',     color: '#7c3aed' }
  };

  const TRIAGE_OPTIONS = [
    { key: 'ignore',   label: 'Ignore / Continue',              sub: 'Over-reporting — recalibrate threshold',      color: '#6b7280', hover: '#f9fafb' },
    { key: 'priority', label: 'Queue: Priority Decision',        sub: 'Needs attention — add to decision list',      color: '#d97706', hover: '#fffbeb' },
    { key: 'query',    label: 'Queue: Insufficient Information', sub: 'Cannot triage yet — hold as query',           color: '#2563eb', hover: '#eff6ff' }
  ];

  // ── Data loading ───────────────────────────────────────────────
  async function loadSignals() {
    renderLoading();
    try {
      const res = await fetch('signals.json');
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      signals = await res.json();
      render();
    } catch (e) {
      renderError(e);
    }
  }

  // ── Render helpers ─────────────────────────────────────────────
  function pending() { return signals.filter(s => !triaged[s.id]); }
  function resolved() { return signals.filter(s =>  triaged[s.id]); }

  function renderLoading() {
    document.getElementById('mainContent').innerHTML = `
      <div class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading signals…</div>
      </div>`;
  }

  function renderError(e) {
    document.getElementById('mainContent').innerHTML = `
      <div class="error-state">
        <div class="error-title">Could not load signals</div>
        <div class="error-body">Make sure signals.json is in the same folder as this file and the page is served over HTTP (not opened as a local file).<br><br>Error: ${e.message}</div>
      </div>`;
  }

  function render() {
    renderCatSummary();
    updateTabs();
    if (selectedId) renderDetail();
    else renderList();
  }

  function renderCatSummary() {
    const p = pending();
    document.getElementById('catSummary').innerHTML = [1,2,3].map(c => {
      const count = p.filter(s => s.category === c).length;
      const active = count > 0;
      return `<div class="cat-card ${active ? 'cat'+c+'-active' : 'cat-inactive'}">
        <div class="cat-count">${count}</div>
        <div class="cat-label">${CAT_META[c].label}</div>
      </div>`;
    }).join('');
  }

  function updateTabs() {
    document.getElementById('tabQueue').textContent    = `Queue (${pending().length})`;
    document.getElementById('tabResolved').textContent = `Resolved (${resolved().length})`;
    document.getElementById('tabQueue').className    = 'tab' + (currentView === 'queue'    ? ' active' : '');
    document.getElementById('tabResolved').className = 'tab' + (currentView === 'resolved' ? ' active' : '');
  }

  function renderList() {
    const list = currentView === 'queue' ? pending() : resolved();
    if (!list.length) {
      document.getElementById('mainContent').innerHTML = `<div class="list"><div class="empty">${currentView === 'queue' ? 'No pending signals.' : 'No resolved signals yet.'}</div></div>`;
      return;
    }
    const items = list.map(s => {
      const dec = triaged[s.id];
      const topt = TRIAGE_OPTIONS.find(t => t.key === dec);
      const decHTML = topt ? `<div class="signal-decision" style="color:${topt.color}">✓ ${topt.label}</div>` : '';
      const clickable = currentView === 'queue' ? `onclick="selectSignal(${s.id})"` : '';
      return `<div class="signal-card c${s.category} ${currentView==='resolved'?'resolved':''}" ${clickable}>
        <div class="signal-meta">
          <span class="signal-badge">Cat ${s.category} · ${CAT_META[s.category].label}</span>
          <span class="signal-time">${s.timestamp}</span>
        </div>
        <div class="signal-title">${s.title}</div>
        <div class="signal-detail">${s.detail}</div>
        ${decHTML}
      </div>`;
    }).join('');
    document.getElementById('mainContent').innerHTML = `<div class="list">${items}</div>`;
  }

  function renderDetail() {
    const s = signals.find(x => x.id === selectedId);
    if (!s) { selectedId = null; renderList(); return; }
    const opts = TRIAGE_OPTIONS.map(opt => `
      <button class="triage-btn"
        onmouseover="this.style.background='${opt.hover}';this.style.borderColor='${opt.color}'"
        onmouseout="this.style.background='#fff';this.style.borderColor='#e5e7eb'"
        onclick="doTriage(${s.id},'${opt.key}')">
        <div class="triage-btn-title" style="color:${opt.color}">${opt.label}</div>
        <div class="triage-btn-sub">${opt.sub}</div>
      </button>`).join('');
    document.getElementById('mainContent').innerHTML = `
      <div class="detail">
        <button class="back-btn" onclick="goBack()">← Back</button>
        <div class="detail-card c${s.category}">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <span class="detail-badge">Cat ${s.category} · ${CAT_META[s.category].label}</span>
            <span class="signal-time">${s.timestamp}</span>
          </div>
          <div class="detail-title">${s.title}</div>
          <div class="detail-body">${s.detail}</div>
        </div>
        <div class="triage-label">Acknowledge as:</div>
        ${opts}
      </div>`;
  }

  // ── Actions ────────────────────────────────────────────────────
  function switchTab(tab) {
    currentView = tab;
    selectedId = null;
    render();
  }

  function selectSignal(id) {
    selectedId = id;
    render();
  }

  function goBack() {
    selectedId = null;
    render();
  }

  function doTriage(id, decision) {
    triaged[id] = decision;
    selectedId = null;
    render();
  }

  // ── Boot ───────────────────────────────────────────────────────
  loadSignals();
</script>
</body>
</html>
